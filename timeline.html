<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeline</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            text-align: center;
            background-color: #f9f9f9;
        }
        nav {
            background-color: #333;
            padding: 10px 0;
            display: flex;
            justify-content: center;
            width: 100%;
        }
        nav a {
            color: #fff;
            padding: 10px 20px;
            text-decoration: none;
            font-weight: bold;
        }
        nav a.active {
            background-color: #555;
            border-radius: 5px;
        }
        .content {
            max-width: 900px;
            margin: 40px auto;
            background: #fff;
            padding: 40px 20px;
            border-radius: 10px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        }
        #inputBox {
            width: 100%;
            height: 150px;
            resize: none;
        }
        #timeline {
            margin-top: 30px;
            width: 100%;
            position: relative;
            height: 60px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .segment {
            position: absolute;
            top: 0;
            height: 100%;
        }
        .free { background-color: #7ed957; }
        .busy { background-color: #ff5757; }
        .override { background-color: yellow !important; }
            .hour-marker {
            position: absolute;
            top: 0;
            width: 1px;
            height: 100%;
            background: #0003;
        }
        .hour-label {
            position: absolute;
            top: -20px;
            font-size: 12px;
            transform: translateX(-50%);
        }
</style>
</head>
<body>

<nav>
    <a class="active">Timeline</a>
</nav>

<div class="content">
    <h2>Call Timeline Visualizer</h2>
    <p>Paste your raw time list below:</p>
    <textarea id="inputBox"></textarea>
    <br><br>
    <button onclick="drawTimeline()">Parse & Draw</button>

    <div id="timeline"></div>
</div>

<script>
let yellow = null;
let drag = null;
let startX = 0;

function parseTime(t) {
    let [time, ampm] = t.split(" ");
    let [h, m] = time.split(":").map(Number);
    if (ampm === "PM" && h !== 12) h += 12;
    if (ampm === "AM" && h === 12) h = 0;
    return h * 60 + m;
}

function drawTimeline() {
    const raw = document.getElementById("inputBox").value.trim().split("\n");
    const timeline = document.getElementById("timeline");

    timeline.innerHTML = ""; // Clear everything EXCEPT yellow we re-add later

    const start = 8 * 60;
    const end = 17 * 60 + 30;
    const total = end - start;

    // --- Hour markers ---
    for (let h = 8; h <= 17; h++) {
        const pos = ((h * 60 - start) / total) * 100;
        const m = document.createElement("div");
        m.className = "hour-marker";
        m.style.left = pos + "%";
        timeline.appendChild(m);

        const label = document.createElement("div");
        label.className = "hour-label";
        label.style.left = pos + "%";
        label.textContent = h + ":00";
        timeline.appendChild(label);
    }

    // --- Parse call ranges ---
    let calls = raw.map(line => {
        let parts = line.split("\t");
        if (parts.length !== 2) return null;
        return { from: parseTime(parts[0]), to: parseTime(parts[1]) };
    }).filter(x => x);

    // --- Busy segments ---
    calls.forEach(c => {
        let div = document.createElement("div");
        div.className = "segment busy";
        div.style.left = ((c.from - start) / total) * 100 + "%";
        div.style.width = ((c.to - c.from) / total) * 100 + "%";
        timeline.appendChild(div);
    });

    // --- Free segments ---
    let freeSegments = [];
    let last = start;

    calls.forEach(c => {
        if (c.from > last) freeSegments.push({ from: last, to: c.from });
        last = c.to;
    });
    if (last < end) freeSegments.push({ from: last, to: end });

    freeSegments.forEach(c => {
        let div = document.createElement("div");
        div.className = "segment free";
        div.style.left = ((c.from - start) / total) * 100 + "%";
        div.style.width = ((c.to - c.from) / total) * 100 + "%";
        timeline.appendChild(div);
    });

    // --- Restore yellow line at end so it stays on top ---
    if (!yellow) {
        yellow = document.createElement("div");
        yellow.className = "segment override";
        yellow.style.left = "20%";
        yellow.style.width = "10%";
        yellow.style.position = "absolute";

        const leftH = document.createElement("div");
        const rightH = document.createElement("div");
        leftH.style.position = rightH.style.position = "absolute";
        leftH.style.top = rightH.style.top = "0";
        leftH.style.width = rightH.style.width = "6px";
        leftH.style.height = rightH.style.height = "100%";
        leftH.style.cursor = "ew-resize";
        rightH.style.cursor = "ew-resize";
        leftH.style.left = "0";
        rightH.style.right = "0";

        yellow.appendChild(leftH);
        yellow.appendChild(rightH);

        yellow.onmousedown = e => {
            if (e.target === leftH) drag = "resize-left";
            else if (e.target === rightH) drag = "resize-right";
            else drag = "move";
            startX = e.clientX;
            e.preventDefault();
        };

        document.onmouseup = () => drag = null;
        document.onmousemove = e => {
            if (!drag) return;
            const dx = e.clientX - startX;
            startX = e.clientX;

            const box = timeline.getBoundingClientRect();
            const ybox = yellow.getBoundingClientRect();

            let leftPct = (ybox.left - box.left) / box.width * 100;
            let widthPct = ybox.width / box.width * 100;

            if (drag === "move") {
                leftPct += dx / box.width * 100;
                leftPct = Math.max(0, Math.min(leftPct, 100 - widthPct));
            }
            if (drag === "resize-left") {
                const change = dx / box.width * 100;
                leftPct += change;
                widthPct -= change;
                if (widthPct < 1) widthPct = 1;
                if (leftPct < 0) leftPct = 0;
            }
            if (drag === "resize-right") {
                widthPct += dx / box.width * 100;
                if (leftPct + widthPct > 100) widthPct = 100 - leftPct;
                if (widthPct < 1) widthPct = 1;
            }

            yellow.style.left = leftPct + "%";
            yellow.style.width = widthPct + "%";
        };
    }

    timeline.appendChild(yellow);
}
</script>

</body>
</html>
